var BOARD_DATA_URL = 'OVERRIDE THIS IN VIEW';
var GAME_SERVER_URL = 'OVERRIDE THIS IN VIEW';
var GAME_ID = 'OVERRIDE THIS IN VIEW';
var USER_ID = 'OVERRIDE THIS IN VIEW';
var USER_AUTH_TOKEN = 'OVERRIDE THIS IN VIEW';

var game_board = null;
var game_data = null;

// Disable mobile device scrolling
function stopScrolling( touchEvent ) { touchEvent.preventDefault(); }
document.addEventListener( 'touchmove' , stopScrolling , false );

$(document).ready(function () {

  var initiative = InitializeInitiativeApi();
  var toolBars = InitializeToolBarsApi();

  game_board = new Board($("#game_board")[0], toolBars, initiative);

  $(window).resize(function() {
    setCanvasSize();
  });

  setCanvasSize();
  refreshBoard();
});

window.requestAnimFrame = (function () {
  return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
          function (callback) {
            window.setTimeout(callback, 1000 / 60);
          };
})();

function setCanvasSize() {
  // Set game board size
  var portWidth = $(window).width();
  var portHeight = $(window).height();
  game_board.setCanvasSize(
          ((portWidth - $("#game_gutter").outerWidth()) - 20),
          ((portHeight - $("#game_header").outerHeight()) - 20));
}

function draw_game() {
  game_board.update();

  window.requestAnimFrame(draw_game);
}

function setSize(zoom) {
  game_board.setZoom(parseFloat(zoom));
}

function refreshBoard() {
  $.getJSON(BOARD_DATA_URL, function (data) {
    game_data = data;
    setSize($("#zoom_level").val());
    game_board.refresh(data);
    draw_game();
  });
}